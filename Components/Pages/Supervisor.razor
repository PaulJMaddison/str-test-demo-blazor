@page "/supervisor"
@using str_test_demo_blazor.Components.Charts

<PageTitle>Supervisor Dashboard</PageTitle>

<h1>Supervisor Dashboard</h1>
<p class="text-muted">Monthly supervisory overview for testing throughput, quality, and cycle times.</p>

<section class="kpi-grid mb-4" aria-label="Supervisor KPI metrics">
    @foreach (var metric in KpiCards)
    {
        <article class="metric-card @metric.ThemeClass">
            <div class="metric-card__icon-wrap" aria-hidden="true">
                <img src="@metric.IconPath" alt="" class="metric-card__icon" />
            </div>
            <p class="metric-card__label">@metric.Label</p>
            <p class="metric-card__value">@metric.Value</p>
        </article>
    }
</section>


<section class="card str-card mb-4" aria-label="Supervisor filters">
    <div class="card-body supervisor-filters">
        <div>
            <label class="form-label" for="time-window">Time Window</label>
            <select id="time-window" class="form-select" @bind="SelectedWindow">
                <option>7 days</option>
                <option>30 days</option>
                <option>90 days</option>
            </select>
        </div>
        <div>
            <label class="form-label" for="supervisor-region">Region</label>
            <select id="supervisor-region" class="form-select" @bind="SelectedRegion">
                <option>All Regions</option>
                <option>North</option>
                <option>South</option>
                <option>East</option>
                <option>West</option>
            </select>
        </div>
        <div>
            <label class="form-label" for="owner-filter">Owner</label>
            <select id="owner-filter" class="form-select" @bind="SelectedOwner">
                <option>All Owners</option>
                <option>Field Team A</option>
                <option>Field Team B</option>
                <option>Contractor</option>
            </select>
        </div>
    </div>
</section>

<section class="supervisor-chart-grid mb-4" aria-label="Regional and outcome charts">
    <article class="card str-card supervisor-panel" aria-labelledby="region-chart-title">
        <div class="card-body">
            <h2 class="h5" id="region-chart-title">Tests Completed per Region</h2>
            <div class="str-card" style="height:300px">
                <ChartJsWrapper ChartId="supervisor-region-chart" ChartType="bar" Labels="@RegionLabels" Data="@RegionValues" BackgroundColors="@RegionColors" />
            </div>
        </div>
    </article>

    <article class="card str-card supervisor-panel" aria-labelledby="pass-fail-chart-title">
        <div class="card-body">
            <h2 class="h5" id="pass-fail-chart-title">Overall Pass/Fail Rate</h2>
            <div class="str-card" style="height:300px">
                <ChartJsWrapper ChartId="supervisor-outcome-chart" ChartType="doughnut" Labels="@OutcomeLabels" Data="@OutcomeValues" BackgroundColors="@OutcomeColors" />
            </div>
        </div>
    </article>
</section>

<section class="card str-card supervisor-panel mb-4" aria-labelledby="type-chart-title">
    <div class="card-body">
        <h2 class="h5" id="type-chart-title">Average Time per Test Type</h2>
        <div class="str-card" style="height:300px">
            <ChartJsWrapper ChartId="supervisor-type-chart" ChartType="bar" Labels="@TestTypeLabels" Data="@TestTypeValues" BackgroundColors="@TestTypeColors" />
        </div>
    </div>
</section>

@code {
    private string SelectedWindow { get; set; } = "30 days";
    private string SelectedRegion { get; set; } = "All Regions";
    private string SelectedOwner { get; set; } = "All Owners";

    private static readonly IReadOnlyList<KpiMetric> KpiCards =
    [
        new("Tests This Month", "152", "metric-card--today", "demo-images/icon-clipboard.svg"),
        new("Overdue Tests", "18", "metric-card--overdue", "demo-images/icon-alert.svg"),
        new("Avg Completion Time", "64 min", "metric-card--completion", "demo-images/icon-timer.svg"),
        new("Unassigned Tests", "9", "metric-card--open", "demo-images/icon-dashboard.svg")
    ];

    private static readonly IReadOnlyList<RegionMetric> RegionData =
    [
        new("North", 36),
        new("South", 28),
        new("East", 33),
        new("West", 24),
        new("Central", 31)
    ];

    private static readonly IReadOnlyList<TestTypeMetric> TestTypeData =
    [
        new("Electrical Safety", 72),
        new("Functional", 58),
        new("Calibration", 66),
        new("Visual Inspection", 41),
        new("Leak Test", 53)
    ];

    private static string[] RegionLabels => RegionData.Select(region => region.Name).ToArray();
    private static double[] RegionValues => RegionData.Select(region => (double)region.Completed).ToArray();
    private static string[] RegionColors => ["#4472c4", "#5b9bd5", "#70ad47", "#ffc000", "#ed7d31"];

    private static string[] OutcomeLabels => ["Pass", "Fail", "N/A"];
    private static double[] OutcomeValues => [82, 12, 6];
    private static string[] OutcomeColors => ["#70ad47", "#ed7d31", "#a5a5a5"];

    private static string[] TestTypeLabels => TestTypeData.Select(testType => testType.Name).ToArray();
    private static double[] TestTypeValues => TestTypeData.Select(testType => (double)testType.AverageMinutes).ToArray();
    private static string[] TestTypeColors => ["#264478", "#4472c4", "#5b9bd5", "#70ad47", "#ffc000"];

    private sealed record KpiMetric(string Label, string Value, string ThemeClass, string IconPath);
    private sealed record RegionMetric(string Name, int Completed);
    private sealed record TestTypeMetric(string Name, int AverageMinutes);
}
